window.autosave=function(){return true};(function($,window){function autosave(){var initialCompareString,lastTriggerSave=0,$document=$(document);function getPostData(type){var post_name,parent_id,data,time=(new Date()).getTime(),cats=[],editor=typeof tinymce!=='undefined'&&tinymce.get('content');if(editor&&!editor.isHidden()&&time-3000>lastTriggerSave){editor.save();lastTriggerSave=time}data={post_id:$('#post_ID').val()||0,post_type:$('#post_type').val()||'',post_author:$('#post_author').val()||'',post_title:$('#title').val()||'',content:$('#content').val()||'',excerpt:$('#excerpt').val()||''};if(type==='local'){return data}$('input[id^="in-category-"]:checked').each(function(){cats.push(this.value)});data.catslist=cats.join(',');if(post_name=$('#post_name').val()){data.post_name=post_name}if(parent_id=$('#parent_id').val()){data.parent_id=parent_id}if($('#comment_status').prop('checked')){data.comment_status='open'}if($('#ping_status').prop('checked')){data.ping_status='open'}if($('#auto_draft').val()==='1'){data.auto_draft='1'}return data}function getCompareString(postData){if(typeof postData==='object'){return(postData.post_title||'')+'::'+(postData.content||'')+'::'+(postData.excerpt||'')}return($('#title').val()||'')+'::'+($('#content').val()||'')+'::'+($('#excerpt').val()||'')}function disableButtons(){$document.trigger('autosave-disable-buttons');setTimeout(enableButtons,5000)}function enableButtons(){$document.trigger('autosave-enable-buttons')}function autosaveLocal(){var restorePostData,undoPostData,blog_id,post_id,hasStorage,intervalTimer,lastCompareString,isSuspended=false;function checkStorage(){var test=Math.random().toString(),result=false;try{window.sessionStorage.setItem('wp-test',test);result=window.sessionStorage.getItem('wp-test')===test;window.sessionStorage.removeItem('wp-test')}catch(e){}hasStorage=result;return result}function getStorage(){var stored_obj=false;if(hasStorage&&blog_id){stored_obj=sessionStorage.getItem('wp-autosave-'+blog_id);if(stored_obj){stored_obj=JSON.parse(stored_obj)}else{stored_obj={}}}return stored_obj}function setStorage(stored_obj){var key;if(hasStorage&&blog_id){key='wp-autosave-'+blog_id;sessionStorage.setItem(key,JSON.stringify(stored_obj));return sessionStorage.getItem(key)!==null}return false}function getSavedPostData(){var stored=getStorage();if(!stored||!post_id){return false}return stored['post_'+post_id]||false}function setData(stored_data){var stored=getStorage();if(!stored||!post_id){return false}if(stored_data){stored['post_'+post_id]=stored_data}else if(stored.hasOwnProperty('post_'+post_id)){delete stored['post_'+post_id]}else{return false}return setStorage(stored)}function suspend(){isSuspended=true}function resume(){isSuspended=false}function save(data){var postData,compareString,result=false;if(isSuspended||!hasStorage){return false}if(data){postData=getSavedPostData()||{};$.extend(postData,data)}else{postData=getPostData('local')}compareString=getCompareString(postData);if(typeof lastCompareString==='undefined'){lastCompareString=initialCompareString}if(compareString===lastCompareString){return false}postData.save_time=(new Date()).getTime();postData.status=$('#post_status').val()||'';result=setData(postData);if(result){lastCompareString=compareString}return result}function run(){post_id=$('#post_ID').val()||0;if($('#wp-content-wrap').hasClass('tmce-active')){$document.on('tinymce-editor-init.autosave',function(){window.setTimeout(function(){checkPost()},1500)})}else{checkPost()}intervalTimer=window.setInterval(save,15000);$('form#post').on('submit.autosave-local',function(){var editor=typeof tinymce!=='undefined'&&tinymce.get('content'),post_id=$('#post_ID').val()||0;if(editor&&!editor.isHidden()){editor.on('submit',function(){save({post_title:M2Unicode($('#title').val())||'',content:M2Unicode($('#content').val())||'',excerpt:M2Unicode($('#excerpt').val())||''})})}else{save({post_title:M2Unicode($('#title').val())||'',content:M2Unicode($('#content').val())||'',excerpt:M2Unicode($('#excerpt').val())||''})}wpCookies.set('wp-saving-post',post_id+'-check',24*60*60)})}function compare(str1,str2){function removeSpaces(string){return string.toString().replace(/[\x20\t\r\n\f]+/g,'')}return(removeSpaces(str1||'')===removeSpaces(str2||''))}function checkPost(){var content,post_title,excerpt,$notice,postData=getSavedPostData(),cookie=wpCookies.get('wp-saving-post');if(cookie===post_id+'-saved'){wpCookies.remove('wp-saving-post');setData(false);return}if(!postData){return}if($('#has-newer-autosave').length){return}content=$('#content').val()||'';post_title=$('#title').val()||'';excerpt=$('#excerpt').val()||'';if(compare(content,postData.content)&&compare(post_title,postData.post_title)&&compare(excerpt,postData.excerpt)){return}restorePostData=postData;undoPostData={content:content,post_title:post_title,excerpt:excerpt};$notice=$('#local-storage-notice');$('.wrap h2').first().after($notice.addClass('updated').show());$notice.on('click.autosave-local',function(event){var $target=$(event.target);if($target.hasClass('restore-backup')){restorePost(restorePostData);$target.parent().hide();$(this).find('p.undo-restore').show()}else if($target.hasClass('undo-restore-backup')){restorePost(undoPostData);$target.parent().hide();$(this).find('p.local-restore').show()}event.preventDefault()})}function restorePost(postData){var editor;if(postData){lastCompareString=getCompareString(postData);if($('#title').val()!==postData.post_title){$('#title').focus().val(postData.post_title||'')}$('#excerpt').val(postData.excerpt||'');editor=typeof tinymce!=='undefined'&&tinymce.get('content');if(editor&&!editor.isHidden()&&typeof switchEditors!=='undefined'){editor.undoManager.add();editor.setContent(postData.content?switchEditors.wpautop(postData.content):'')}else{$('#content-html').click();$('#content').val(postData.content)}return true}return false}blog_id=typeof window.autosaveL10n!=='undefined'&&window.autosaveL10n.blog_id;if(checkStorage()&&blog_id&&($('#content').length||$('#excerpt').length)){$document.ready(run)}return{hasStorage:hasStorage,getSavedPostData:getSavedPostData,save:save,suspend:suspend,resume:resume}}function autosaveServer(){var _blockSave,_blockSaveTimer,previousCompareString,lastCompareString,nextRun=0,isSuspended=false;function tempBlockSave(){_blockSave=true;window.clearTimeout(_blockSaveTimer);_blockSaveTimer=window.setTimeout(function(){_blockSave=false},10000)}function suspend(){isSuspended=true}function resume(){isSuspended=false}function response(data){_schedule();_blockSave=false;lastCompareString=previousCompareString;previousCompareString='';$document.trigger('after-autosave',[data]);enableButtons();if(data.success){$('#auto_draft').val('')}}function triggerSave(){nextRun=0;wp.heartbeat.connectNow()}function postChanged(){return getCompareString()!==initialCompareString}function save(){var postData,compareString;if(isSuspended||_blockSave||!window.autosave()){return false}if((new Date()).getTime()<nextRun){return false}postData=getPostData();compareString=getCompareString(postData);if(typeof lastCompareString==='undefined'){lastCompareString=initialCompareString}if(compareString===lastCompareString){return false}previousCompareString=compareString;tempBlockSave();disableButtons();$document.trigger('wpcountwords',[postData.content]).trigger('before-autosave',[postData]);postData._wpnonce=$('#_wpnonce').val()||'';return postData}function _schedule(){nextRun=(new Date()).getTime()+(autosaveL10n.autosaveInterval*1000)||60000}$document.on('heartbeat-send.autosave',function(event,data){var autosaveData=save();if(autosaveData){data.wp_autosave=autosaveData}}).on('heartbeat-tick.autosave',function(event,data){if(data.wp_autosave){response(data.wp_autosave)}}).on('heartbeat-connection-lost.autosave',function(event,error,status){if('timeout'===error||603===status){var $notice=$('#lost-connection-notice');if(!wp.autosave.local.hasStorage){$notice.find('.hide-if-no-sessionstorage').hide()}$notice.show();disableButtons()}}).on('heartbeat-connection-restored.autosave',function(){$('#lost-connection-notice').hide();enableButtons()}).ready(function(){_schedule()});return{tempBlockSave:tempBlockSave,triggerSave:triggerSave,postChanged:postChanged,suspend:suspend,resume:resume}}$document.on('tinymce-editor-init.autosave',function(event,editor){if(editor.id==='content'){window.setTimeout(function(){editor.save();initialCompareString=getCompareString()},1000)}}).ready(function(){initialCompareString=getCompareString()});return{getPostData:getPostData,getCompareString:getCompareString,disableButtons:disableButtons,enableButtons:enableButtons,local:autosaveLocal(),server:autosaveServer()}}window.wp=window.wp||{};window.wp.autosave=autosave()}(jQuery,window));